<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CS2 Skin Float & Rarity Checker</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#7dd3fc}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:linear-gradient(180deg,#071023 0%, #061226 100%);color:#e6eef6}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:20px}
    .card{background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
    .search-row{display:flex;gap:12px;margin-top:12px}
    input[type=text],input[type=number],select{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:8px;color:inherit;flex:1}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#012;cursor:pointer}
    .results{margin-top:12px;display:grid;grid-template-columns:1fr 320px;gap:16px}
    .list{max-height:420px;overflow:auto}
    .item{display:flex;gap:12px;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
    .item:hover{background:rgba(125,211,252,0.04)}
    img.skin{width:120px;height:60px;object-fit:contain;background:linear-gradient(90deg,#0004,#0000);border-radius:6px}
    .meta{font-size:13px;color:var(--muted)}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:600;margin-right:8px}
    .rare{background:linear-gradient(90deg,#ffd9a8,#ffb4b4);color:#2b0a00}
    .good{background:linear-gradient(90deg,#bbf7d0,#86efac);color:#04260b}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .notice{color:#ffd966}
    @media(max-width:880px){.results{grid-template-columns:1fr}img.skin{width:100px;height:50px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>CS2 Skin Float & Rarity Checker</h1>
        <div class="meta">Search any skin, paste a float (0–1) and check exterior + rarity heuristics.</div>
      </div>
    </header>

    <section class="card" id="app">
      <div style="display:flex;gap:12px;align-items:center;">
        <input id="search" type="text" placeholder="Search skin name (e.g. AWP | Asiimov)" aria-label="search" />
        <button id="clear">Clear</button>
      </div>

      <div class="search-row">
        <div class="card list" style="flex:1">
          <div id="list-message" class="meta">Loading skins database...</div>
          <div id="results"></div>
        </div>

        <div class="card" style="width:320px;min-height:240px">
          <div id="selected-area">
            <div class="meta">No skin selected — search above and click a result.</div>
          </div>

          <hr style="opacity:.06;margin:12px 0" />

          <div>
            <label class="meta">Enter a float value (0.000000–1.000000)</label>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="float-input" type="number" step="0.000001" min="0" max="1" placeholder="0.123456" />
              <button id="check-btn">Check</button>
            </div>
            <div id="float-result" style="margin-top:12px"></div>
          </div>
        </div>
      </div>

      <footer>
        <div>Notes: This app uses a public skins database (bundled from an open GitHub JSON). Float -> exterior mapping follows standard CS2 wear ranges. If the database can't be fetched due to CORS, the app will attempt a proxy or instruct to run locally.</div>
      </footer>
    </section>
  </div>

<script>
// ---------------- CONFIG ----------------
const API_RAW = 'https://raw.githubusercontent.com/ByMykel/CSGO-API/main/public/api/en/skins.json';
const PROXY_ALLORIGINS = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(API_RAW);

// Exterior thresholds (common standard)
const WEAR_THRESHOLDS = [
  {name: 'Factory New', min:0.0, max:0.07},
  {name: 'Minimal Wear', min:0.07, max:0.15},
  {name: 'Field-Tested', min:0.15, max:0.38},
  {name: 'Well-Worn', min:0.38, max:0.45},
  {name: 'Battle-Scarred', min:0.45, max:1.0}
];

let SKINS = [];
let filtered = [];
let selected = null;

// ---------------- HELPERS ----------------
function fmt(num){return Number(num).toFixed(6)}
function getExterior(floatVal){
  for(const w of WEAR_THRESHOLDS) if(floatVal >= w.min && floatVal <= w.max) return w.name;
  return 'Unknown';
}

function rareHeuristic(floatVal, skin){
  // Heuristics for "rare" floats:
  // 1) Extremely low floats (<= 0.03) are often considered rare/valuable.
  // 2) If the float is at or below the known recorded minimum for the skin, it's notable.
  // 3) Also treat floats <= 0.01 as "extremely rare".
  if(floatVal <= 0.01) return {rare:true,label:'Extremely rare float (<= 0.01)'};
  if(floatVal <= 0.03) return {rare:true,label:'Very low float (<= 0.03)'};
  if(skin && typeof skin.min_float === 'number'){
    if(floatVal <= skin.min_float + 0.000001) return {rare:true,label:`At or below recorded min float (${fmt(skin.min_float)})`};
  }
  return {rare:false,label:'Not particularly rare (based on float)'};
}

// ---------------- UI ----------------
const searchEl = document.getElementById('search');
const resultsEl = document.getElementById('results');
const listMessage = document.getElementById('list-message');
const selectedArea = document.getElementById('selected-area');
const floatInput = document.getElementById('float-input');
const checkBtn = document.getElementById('check-btn');
const floatResult = document.getElementById('float-result');
const clearBtn = document.getElementById('clear');

clearBtn.addEventListener('click', ()=>{searchEl.value='';renderList(SKINS);selected=null;selectedArea.innerHTML='<div class="meta">No skin selected — search above and click a result.</div>';floatResult.innerHTML='';});

searchEl.addEventListener('input', ()=>{
  const q = searchEl.value.trim().toLowerCase();
  if(!q){renderList(SKINS);return}
  const out = SKINS.filter(s=>s.name.toLowerCase().includes(q) || (s.weapon && s.weapon.name && s.weapon.name.toLowerCase().includes(q)));
  renderList(out.slice(0,200));
});

checkBtn.addEventListener('click', ()=>{
  const v = Number(floatInput.value);
  if(isNaN(v) || v < 0 || v > 1){floatResult.innerHTML='<div class="meta" style="color:#ffb4b4">Please enter a valid float between 0 and 1.</div>';return}
  const exterior = getExterior(v);
  const hr = rareHeuristic(v, selected);
  let html = `<div><strong>Float:</strong> ${fmt(v)} — <em>${exterior}</em></div>`;
  html += `<div style="margin-top:8px">${hr.rare ? '<span class="badge rare">RARE</span>' : '<span class="badge good">Common</span>'} ${hr.label}</div>`;
  if(selected){
    if(typeof selected.min_float === 'number' && typeof selected.max_float === 'number'){
      html += `<div class="meta" style="margin-top:8px">Skin allowed float range: ${fmt(selected.min_float)} — ${fmt(selected.max_float)}</div>`;
      if(v < selected.min_float || v > selected.max_float) html += `<div class="meta" style="color:#ffd6a5;margin-top:6px">Note: this float is outside the recorded range for this skin.</div>`;
    }
  }
  floatResult.innerHTML = html;
});

function renderList(list){
  filtered = list;
  if(!list || list.length === 0){resultsEl.innerHTML = '<div class="meta">No results</div>';return}
  listMessage.style.display='none';
  resultsEl.innerHTML = '';
  for(const s of list.slice(0,200)){
    const div = document.createElement('div');
    div.className='item';
    div.innerHTML = `
      <img class="skin" src="${s.image || ''}" alt="${s.name}" onerror="this.style.display='none'" />
      <div style="flex:1">
        <div style="font-weight:700">${s.name}</div>
        <div class="meta">${s.weapon && s.weapon.name ? s.weapon.name + ' · ' : ''}${s.rarity && s.rarity.name ? s.rarity.name : ''}</div>
        <div class="meta" style="margin-top:6px">min float: ${typeof s.min_float==='number'?fmt(s.min_float):'n/a'} — max float: ${typeof s.max_float==='number'?fmt(s.max_float):'n/a'}</div>
      </div>
    `;
    div.addEventListener('click', ()=>selectSkin(s));
    resultsEl.appendChild(div);
  }
}

function selectSkin(s){
  selected = s;
  const html = `
    <div style="display:flex;gap:12px;align-items:center">
      <img class="skin" src="${s.image || ''}" alt="${s.name}" onerror="this.style.display='none'" />
      <div>
        <div style="font-weight:800">${s.name}</div>
        <div class="meta">${s.weapon?.name || ''} · ${s.rarity?.name || ''}</div>
        <div class="meta">min float: ${typeof s.min_float==='number'?fmt(s.min_float):'n/a'} — max float: ${typeof s.max_float==='number'?fmt(s.max_float):'n/a'}</div>
        <div style="margin-top:8px"><button id="copy-name">Copy name</button></div>
      </div>
    </div>
  `;
  selectedArea.innerHTML = html;
  const copyBtn = document.getElementById('copy-name');
  copyBtn.addEventListener('click', ()=>navigator.clipboard.writeText(s.name).then(()=>{
    copyBtn.textContent='Copied!';setTimeout(()=>copyBtn.textContent='Copy name',900);
  }))
}

// ---------------- DATA LOAD ----------------
async function loadData(){
  try{
    listMessage.textContent = 'Fetching skins database...';
    const r = await fetch(API_RAW);
    if(!r.ok) throw new Error('fetch failed');
    const data = await r.json();
    SKINS = data;
    listMessage.style.display='none';
    renderList(SKINS.slice(0,200));
  }catch(err){
    console.warn('Direct fetch failed, trying proxy fallback', err);
    // try allorigins as fallback
    try{
      const r2 = await fetch(PROXY_ALLORIGINS);
      if(!r2.ok) throw new Error('proxy failed');
      const data2 = await r2.json();
      SKINS = data2;
      listMessage.style.display='none';
      renderList(SKINS.slice(0,200));
    }catch(err2){
      console.error('Both fetch attempts failed',err2);
      listMessage.innerHTML = '<div class="meta">Failed to load skins database. Possible CORS/network issue. Try running this file from a local server (e.g. `npx http-server`) or host it on a site. The app will still work if you paste a skin object into the console.</div>';
    }
  }
}

loadData();
</script>
</body>
</html>

